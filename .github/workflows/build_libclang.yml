name: build libclang Task

on:
  workflow_dispatch:
    inputs:
      llvm-version:
        description: 'libclang Build Version'
        required: true
        type: string
      mingw:
        description: 'mingw Version'
        required: true
        type: string     
      build-date:     
        description: 'build date'
        required: true
        type: string       
      upload:
        description: 'Upload binaries to the release page'
        required: true
        default: false
        type: boolean
      runs-on:
        description: "Runner to use for the build"
        required: true
        type: choice
        options:
          - ubuntu-22.04
          - windows-2022
  

  workflow_call:
    inputs:
      llvm-version:
        description: 'libclang Build Version'
        required: true
        type: string
      mingw:
        description: 'mingw Version'
        required: true
        type: string        
      build-date:     
        description: 'build date'
        required: true
        type: string       
      upload:
        description: 'Upload binaries to the release page'
        required: true
        default: false
        type: boolean
      runs-on:
        description: "Runner to use for the build"
        required: true
        type: string
    # secrets:
    #   RELEASE_TASKS_USER_TOKEN:
    #     description: "Secret used to check user permissions."
    #     required: false
jobs:
  # define-build-mode:
  # runs-on: ubuntu-latest
  # outputs: 
  #   build-mode: ${{ steps.modes.outputs.build-mode }}
  # steps:
  #   - name: Define build mode
  #     id: modes
  #     run: |
  #       echo 'build-mode=["shared", "static"]' >> "$GITHUB_OUTPUT"

  build:
    name: buil libclang    
    strategy:
      matrix:
        buildmode: [shared, static]
    runs-on: ${{ inputs.runs-on }}

      
    steps:

      - name: check out 
        uses: actions/checkout@v4   

      - name: toolsets Test 
        shell: cmd
        run: |
          echo -------------------- test cmake --------------------------
          cmake --version
          echo -------------------- test ninja --------------------------
          ninja --version
          echo -------------------- test 7z --------------------------
          7z 

      # - name: Checkout llvm
      #   uses: actions/checkout@v4
      #   with:
      #     repository: 'llvm/llvm-project'
      #     ref: 'llvmorg-${{ inputs.llvm-version }}'
      # - name: Checkout openssl
      #   uses: actions/checkout@v4
      #   with:
      #     repository: 'openssl/openssl'
      #     ref: 'openssl-${{ inputs.openssl-version }}'
      #     path: openssl

      # - uses: msys2/setup-msys2@v2
      #   with:
      #     msystem: UCRT64
      #     update: false

  test:
    name: test
    needs: build
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Test 
        shell: cmd
        run: |
          echo "llvm-version=${{ inputs.llvm-version }}"
          # echo "build mode = ${{ needs.build.ouputs.build-mode}}"



      # - shell: cmd
          #  set mingw=${{ inputs.mingw }}
          #  set START=%CD%
          #  set QT_Ver=${{ inputs.qt-version }}
          #  # 第一个参数为Qt版本, 第二个参数开始为路径如MinGW\bin
          #  python ./utils/msys2_mod.py %QT_Ver% %START%\MinGW\bin
          #  curl -L -o  %mingw%.7z  https://github.com/njuFerret/qt6_mingw_build/releases/download/deps/%mingw%.7z
          #  7z x %mingw%.7z
          #  if exist mingw64 (
          #     move mingw64 MinGW
          #  )
          #  mkdir D:\Dev\Qt\%QT_Ver%\3rdParty\openssl
          #  echo test > D:\Dev\Qt\%QT_Ver%\3rdParty\openssl\build.txt

      
        
          
      # - name: 7ziped openssl folder
      #   shell: cmd
      #   run: |
      #     7z a openssl-${{ inputs.openssl-version }}_${{ inputs.mingw }}.7z D:\Dev\Qt\${{ inputs.qt-version }}\3rdParty\openssl
      #     dir

      # - name: upload openssl-${{ inputs.openssl-version }} binaries
      #   uses:  actions/upload-artifact@v4.4.3
      #   with:
      #     name: 'openssl'
      #     path: ./openssl-${{ inputs.openssl-version }}_${{ inputs.mingw }}.7z


  # release:
  #   permissions:
  #     contents: write
  
  #   runs-on: ubuntu-latest
  #   needs: [build]

  #   steps:
  #   - name: Download openssl
  #     uses: actions/download-artifact@v4
  #     with:          
  #       name: 'openssl'          
  #       # merge-multiple: true
  #       path: ./

  #   - name: Unzip openssl
  #     shell: bash
  #     run: |
  #       ls -l   
  #       7z x openssl-${{ inputs.openssl-version }}_${{ inputs.mingw }}.7z
  #       ls -l
  #       ls -l openssl 


  #   - name: Upload to Release
  #     id: upload_to_release
  #     uses: softprops/action-gh-release@v2
  #     with:
  #       files: "*.7z"
  #       tag_name: build_${{ inputs.build-date }}



